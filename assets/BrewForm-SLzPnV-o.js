import{p as w,r as g,v as N,n as s,w as C,x as V}from"./index-eYg_DNUH.js";import{u as S,t as a}from"./chunk-QESP63UR-Cxz4EwhM.js";import{i as o}from"./chunk-SSA7SXE4-e3M61gmc.js";import{w as y,x as F,y as _,z as b,A as m,v as c}from"./chunk-O24IAYCG-B8IVXknZ.js";import{s as R}from"./chunk-EUS52Q2W-8FeBydiF.js";import"./useFormReset-BCQaNZLk.js";function W({initialData:r}){const p=w(),[j,v]=g.useState([]);g.useEffect(()=>{N().then(v)},[]);const l=S({defaultValues:{beanIds:(r==null?void 0:r.beanIds)||[0],date:(r==null?void 0:r.date)||new Date().toISOString().split("T")[0],method:(r==null?void 0:r.method)||"Pour Over",brewer:(r==null?void 0:r.brewer)||"",grinder:(r==null?void 0:r.grinder)||"",beanWeight:(r==null?void 0:r.beanWeight)||0,grindSize:(r==null?void 0:r.grindSize)||"",waterTemp:(r==null?void 0:r.waterTemp)||0,waterVolume:(r==null?void 0:r.waterVolume)||0,recipe:(r==null?void 0:r.recipe)||"",tastingNotes:(r==null?void 0:r.tastingNotes)||"",rating:(r==null?void 0:r.rating)||0,remarks:(r==null?void 0:r.remarks)||""},onSubmit:async({value:e})=>{const n=e.beanIds.filter(h=>h!==0).map(Number);if(n.length===0){alert("Please select at least one bean");return}const d={...e,beanIds:n,beanWeight:Number(e.beanWeight),waterTemp:Number(e.waterTemp),waterVolume:Number(e.waterVolume)};r!=null&&r.id?await C({...d,id:r.id}):await V(d),p({to:"/"})}});return s.jsxs(y,{className:"max-w-[600px] mx-auto",children:[s.jsx(F,{children:s.jsx("h3",{className:"text-xl font-bold",children:r!=null&&r.id?"Edit Brew":"Add New Brew"})}),s.jsx(_,{children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),l.handleSubmit()},className:"flex flex-col gap-4",children:[s.jsx(l.Field,{name:"beanIds",mode:"array",children:e=>s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Beans *"}),e.state.value.map((n,d)=>s.jsx(l.Field,{name:`beanIds[${d}]`,children:h=>s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(b,{"aria-label":"Select Bean",placeholder:"Select a bean",selectedKeys:h.state.value?[String(h.state.value)]:[],onSelectionChange:u=>h.handleChange(Number(Array.from(u)[0])),className:"flex-1",children:j.map(u=>{const x=e.state.value.some((t,B)=>B!==d&&t===u.id);return s.jsxs(m,{textValue:`${u.name} (${u.roastery})`,isDisabled:x,children:[u.name," (",u.roastery,") ",x?"(Selected)":""]},String(u.id))})}),e.state.value.length>1&&s.jsx(c,{isIconOnly:!0,color:"danger",variant:"flat",onPress:()=>e.removeValue(d),size:"sm",children:"X"})]})},d)),s.jsx(c,{variant:"flat",onPress:()=>e.pushValue(0),size:"sm",className:"self-start",children:"+ Add another bean"})]})}),s.jsx(l.Field,{name:"date",children:e=>s.jsx(o,{type:"date",label:"Date",isRequired:!0,name:e.name,value:e.state.value,onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsx(l.Field,{name:"method",children:e=>s.jsxs(b,{label:"Brew Method",isRequired:!0,selectedKeys:[e.state.value],onSelectionChange:n=>e.handleChange(Array.from(n)[0]),children:[s.jsx(m,{children:"Pour Over"},"Pour Over"),s.jsx(m,{children:"Espresso"},"Espresso"),s.jsx(m,{children:"French Press"},"French Press"),s.jsx(m,{children:"Aeropress"},"Aeropress"),s.jsx(m,{children:"Moka Pot"},"Moka Pot"),s.jsx(m,{children:"Cold Brew"},"Cold Brew"),s.jsx(m,{children:"Drip"},"Drip")]})}),s.jsx(l.Field,{name:"brewer",children:e=>s.jsx(o,{label:"Brewer",isRequired:!0,name:e.name,value:e.state.value,onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsx(l.Field,{name:"grinder",children:e=>s.jsx(o,{label:"Grinder",isRequired:!0,name:e.name,value:e.state.value,onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx(l.Field,{name:"beanWeight",children:e=>s.jsx(o,{type:"number",label:"Bean Weight (g)",isRequired:!0,name:e.name,value:String(e.state.value),onBlur:e.handleBlur,onValueChange:n=>e.handleChange(Number(n)),className:"flex-1"})}),s.jsx(l.Field,{name:"grindSize",children:e=>s.jsx(o,{label:"Grind Size",isRequired:!0,name:e.name,value:e.state.value,onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n),className:"flex-1"})})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx(l.Field,{name:"waterTemp",children:e=>s.jsx(o,{type:"number",label:"Water Temp (Â°C)",isRequired:!0,name:e.name,value:String(e.state.value),onBlur:e.handleBlur,onValueChange:n=>e.handleChange(Number(n)),className:"flex-1"})}),s.jsx(l.Field,{name:"waterVolume",children:e=>s.jsx(o,{type:"number",label:"Water Volume (ml)",isRequired:!0,name:e.name,value:String(e.state.value),onBlur:e.handleBlur,onValueChange:n=>e.handleChange(Number(n)),className:"flex-1"})})]}),s.jsx(l.Field,{name:"recipe",children:e=>s.jsx(a,{label:"Recipe",name:e.name,value:e.state.value||"",onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsx(l.Field,{name:"tastingNotes",children:e=>s.jsx(a,{label:"Tasting Notes",name:e.name,value:e.state.value||"",onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsx(l.Field,{name:"rating",children:e=>s.jsx(R,{label:"Rating",step:1,maxValue:5,minValue:1,defaultValue:3,value:e.state.value||3,onChange:n=>e.handleChange(n),className:"max-w-md",showSteps:!0,marks:[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}]})}),s.jsx(l.Field,{name:"remarks",children:e=>s.jsx(a,{label:"Remarks",name:e.name,value:e.state.value||"",onBlur:e.handleBlur,onValueChange:n=>e.handleChange(n)})}),s.jsx(c,{type:"submit",color:"primary",className:"mt-4",children:r!=null&&r.id?"Update Brew":"Add Brew"})]})})]})}export{W as BrewForm};
