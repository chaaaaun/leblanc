var Xt=s=>{throw TypeError(s)};var Yt=(s,i,t)=>i.has(s)||Xt("Cannot "+t);var v=(s,i,t)=>(Yt(s,i,"read from private field"),t?t.call(s):i.get(s)),A=(s,i,t)=>i.has(s)?Xt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,t),w=(s,i,t,r)=>(Yt(s,i,"write to private field"),r?r.call(s,t):i.set(s,t),t);var Zt=(s,i,t,r)=>({set _(e){w(s,i,e,t)},get _(){return v(s,i,r)}});import{y as Fe,r as I,n as k,R as Bt,l as Ee,h as Jt,k as Qt}from"./index-CNX0uGbz.js";import{u as we}from"./chunk-SSA7SXE4-6m6cGOoH.js";import{B as Le}from"./chunk-O24IAYCG-C7X2ncAB.js";const it=new WeakMap,wt=new WeakMap,It={current:[]};let Rt=!1,ft=0;const ct=new Set,yt=new Map;function he(s){const i=Array.from(s).sort((t,r)=>t instanceof U&&t.options.deps.includes(r)?1:r instanceof U&&r.options.deps.includes(t)?-1:0);for(const t of i){if(It.current.includes(t))continue;It.current.push(t),t.recompute();const r=wt.get(t);if(r)for(const e of r){const n=it.get(e);n&&he(n)}}}function Ae(s){const i={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(i)}function Ie(s){const i={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(i)}function fe(s){if(ft>0&&!yt.has(s)&&yt.set(s,s.prevState),ct.add(s),!(ft>0)&&!Rt)try{for(Rt=!0;ct.size>0;){const i=Array.from(ct);ct.clear();for(const t of i){const r=yt.get(t)??t.prevState;t.prevState=r,Ae(t)}for(const t of i){const r=it.get(t);r&&(It.current.push(t),he(r))}for(const t of i){const r=it.get(t);if(r)for(const e of r)Ie(e)}}}finally{Rt=!1,It.current=[],yt.clear()}}function z(s){ft++;try{s()}finally{if(ft--,ft===0){const i=ct.values().next().value;i&&fe(i)}}}function Te(s){return typeof s=="function"}class Tt{constructor(i,t){this.listeners=new Set,this.subscribe=r=>{var e,n;this.listeners.add(r);const a=(n=(e=this.options)==null?void 0:e.onSubscribe)==null?void 0:n.call(e,r,this);return()=>{this.listeners.delete(r),a==null||a()}},this.prevState=i,this.state=i,this.options=t}setState(i){var t,r,e;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(i):Te(i)?this.state=i(this.prevState):this.state=i,(e=(r=this.options)==null?void 0:r.onUpdate)==null||e.call(r),fe(this)}}class U{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=this.options.deps.length,r=new Array(t),e=new Array(t);for(let n=0;n<t;n++){const a=this.options.deps[n];r[n]=a.prevState,e[n]=a.state}return this.lastSeenDepValues=e,{prevDepVals:r,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,r;this.prevState=this.state;const e=this.getDepVals();this.state=this.options.fn(e),(r=(t=this.options).onUpdate)==null||r.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof U&&n.checkIfRecalculationNeededDeeply();let t=!1;const r=this.lastSeenDepValues,{currDepVals:e}=this.getDepVals();for(let n=0;n<e.length;n++)if(e[n]!==r[n]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var r,e;this.listeners.add(t);const n=(e=(r=this.options).onSubscribe)==null?void 0:e.call(r,t,this);return()=>{this.listeners.delete(t),n==null||n()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const t of i)if(t instanceof U)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof Tt){let r=it.get(t);r||(r=new Set,it.set(t,r)),r.add(this);let e=wt.get(this);e||(e=new Set,wt.set(this,e)),e.add(t)}}unregisterFromGraph(i=this.options.deps){for(const t of i)if(t instanceof U)this.unregisterFromGraph(t.options.deps);else if(t instanceof Tt){const r=it.get(t);r&&r.delete(this);const e=wt.get(this);e&&e.delete(t)}}}function Ce(s){return typeof s=="function"}function te(s,...i){return Ce(s)?s(...i):s}function ke(s){return s||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}var j,D,O,mt,G,Y,H,rt,vt,_t,K,gt,nt,Ot;class me{constructor({pluginId:i,debug:t=!1,enabled:r=!0,reconnectEveryMs:e=300}){A(this,j,!0);A(this,D);A(this,O);A(this,mt);A(this,G);A(this,Y);A(this,H);A(this,rt);A(this,vt,0);A(this,_t,5);A(this,K,!1);A(this,gt,()=>{this.debugLog("Connected to event bus"),w(this,Y,!0),w(this,K,!1),this.debugLog("Emitting queued events",v(this,G)),v(this,G).forEach(i=>this.emitEventToBus(i)),w(this,G,[]),this.stopConnectLoop(),v(this,O).call(this).removeEventListener("tanstack-connect-success",v(this,gt))});A(this,nt,()=>{if(v(this,vt)<v(this,_t)){Zt(this,vt)._++,this.dispatchCustomEvent("tanstack-connect",{});return}v(this,O).call(this).removeEventListener("tanstack-connect",v(this,nt)),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()});A(this,Ot,()=>{v(this,K)||(w(this,K,!0),v(this,O).call(this).addEventListener("tanstack-connect-success",v(this,gt)),v(this,nt).call(this))});w(this,D,i),w(this,j,r),w(this,O,this.getGlobalTarget),w(this,mt,t),this.debugLog(" Initializing event subscription for plugin",v(this,D)),w(this,G,[]),w(this,Y,!1),w(this,H,null),w(this,rt,e)}startConnectLoop(){v(this,H)!==null||v(this,Y)||(this.debugLog(`Starting connect loop (every ${v(this,rt)}ms)`),w(this,H,setInterval(v(this,nt),v(this,rt))))}stopConnectLoop(){w(this,K,!1),v(this,H)!==null&&(clearInterval(v(this,H)),w(this,H,null),this.debugLog("Stopped connect loop"))}debugLog(...i){v(this,mt)&&console.log(`ðŸŒ´ [tanstack-devtools:${v(this,D)}-plugin]`,...i)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const i=typeof EventTarget<"u"?new EventTarget:void 0;return typeof i>"u"||typeof i.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),i)}getPluginId(){return v(this,D)}dispatchCustomEventShim(i,t){try{const r=new Event(i,{detail:t});v(this,O).call(this).dispatchEvent(r)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(i,t){try{v(this,O).call(this).dispatchEvent(new CustomEvent(i,{detail:t}))}catch{this.dispatchCustomEventShim(i,t)}}emitEventToBus(i){this.debugLog("Emitting event to client bus",i),this.dispatchCustomEvent("tanstack-dispatch-event",i)}emit(i,t){if(!v(this,j)){this.debugLog("Event bus client is disabled, not emitting event",i,t);return}if(!v(this,Y)){this.debugLog("Bus not available, will be pushed as soon as connected"),v(this,G).push({type:`${v(this,D)}:${i}`,payload:t,pluginId:v(this,D)}),typeof CustomEvent<"u"&&!v(this,K)&&(v(this,Ot).call(this),this.startConnectLoop());return}return this.emitEventToBus({type:`${v(this,D)}:${i}`,payload:t,pluginId:v(this,D)})}on(i,t){const r=`${v(this,D)}:${i}`;if(!v(this,j))return this.debugLog("Event bus client is disabled, not registering event",r),()=>{};const e=n=>{this.debugLog("Received event from bus",n.detail),t(n.detail)};return v(this,O).call(this).addEventListener(r,e),this.debugLog("Registered event to bus",r),()=>{v(this,O).call(this).removeEventListener(r,e)}}onAll(i){if(!v(this,j))return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=r=>{const e=r.detail;i(e)};return v(this,O).call(this).addEventListener("tanstack-devtools-global",t),()=>v(this,O).call(this).removeEventListener("tanstack-devtools-global",t)}onAllPluginEvents(i){if(!v(this,j))return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=r=>{const e=r.detail;v(this,D)&&e.pluginId!==v(this,D)||i(e)};return v(this,O).call(this).addEventListener("tanstack-devtools-global",t),()=>v(this,O).call(this).removeEventListener("tanstack-devtools-global",t)}}j=new WeakMap,D=new WeakMap,O=new WeakMap,mt=new WeakMap,G=new WeakMap,Y=new WeakMap,H=new WeakMap,rt=new WeakMap,vt=new WeakMap,_t=new WeakMap,K=new WeakMap,gt=new WeakMap,nt=new WeakMap,Ot=new WeakMap;class _e extends me{constructor(i){super({pluginId:"pacer",debug:i==null?void 0:i.debug})}}const Oe=(s,i)=>{ve.emit(s,i)},ve=new _e;function ee(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const De={enabled:!0,leading:!0,trailing:!0,wait:0};var q,P,Z,J,Q,at;class xe{constructor(i,t){A(this,q);A(this,P);A(this,Z);A(this,J);A(this,Q);A(this,at);this.fn=i,this.store=new Tt(ee()),this.setOptions=r=>{this.options={...this.options,...r},v(this,Z).call(this)||this.cancel()},w(this,P,r=>{this.store.setState(e=>{const n={...e,...r},{isPending:a}=n;return{...n,status:v(this,Z).call(this)?a?"pending":"idle":"disabled"}}),Oe("Throttler",this)}),w(this,Z,()=>!!te(this.options.enabled,this)),w(this,J,()=>te(this.options.wait,this)),this.maybeExecute=(...r)=>{v(this,P).call(this,{maybeExecuteCount:this.store.state.maybeExecuteCount+1});const e=Date.now(),n=e-this.store.state.lastExecutionTime,a=v(this,J).call(this);if(this.options.leading&&n>=a)v(this,Q).call(this,...r);else if(v(this,P).call(this,{lastArgs:r}),!v(this,q)&&this.options.trailing){const o=this.store.state.lastExecutionTime?e-this.store.state.lastExecutionTime:0,d=a-o;v(this,P).call(this,{isPending:!0}),w(this,q,setTimeout(()=>{const{lastArgs:l}=this.store.state;l!==void 0&&v(this,Q).call(this,...l)},d))}},w(this,Q,(...r)=>{var a,o;if(!v(this,Z).call(this))return;this.fn(...r);const e=Date.now(),n=e+v(this,J).call(this);v(this,at).call(this),v(this,P).call(this,{executionCount:this.store.state.executionCount+1,lastExecutionTime:e,nextExecutionTime:n,isPending:!1,lastArgs:void 0}),(o=(a=this.options).onExecute)==null||o.call(a,r,this),setTimeout(()=>{this.store.state.isPending||v(this,P).call(this,{nextExecutionTime:void 0})},v(this,J).call(this))}),this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&v(this,Q).call(this,...this.store.state.lastArgs)},w(this,at,()=>{v(this,q)&&(clearTimeout(v(this,q)),w(this,q,void 0))}),this.cancel=()=>{v(this,at).call(this),v(this,P).call(this,{lastArgs:void 0,isPending:!1})},this.reset=()=>{v(this,P).call(this,ee())},this.key=ke(t.key),this.options={...De,...t},v(this,P).call(this,this.options.initialState??{}),ve.on("d-Throttler",r=>{r.payload.key===this.key&&(v(this,P).call(this,r.payload.store.state),this.setOptions(r.payload.options))})}}q=new WeakMap,P=new WeakMap,Z=new WeakMap,J=new WeakMap,Q=new WeakMap,at=new WeakMap;function Pe(s,i){return new xe(s,i).maybeExecute}function Dt(s,i){return typeof s=="function"?s(i):s}function ht(s,i){return jt(i).reduce((r,e)=>{if(r===null)return null;if(typeof r<"u")return r[e]},s)}function Mt(s,i,t){const r=jt(i);function e(n){if(!r.length)return Dt(t,n);const a=r.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[a]:e(n[a])}):{[a]:e()};if(Array.isArray(n)&&typeof a=="number"){const o=n.slice(0,a);return[...o.length?o:new Array(a),e(n[a]),...n.slice(a+1)]}return[...new Array(a),e()]}return e(s)}function Re(s,i){const t=jt(i);function r(e){if(!e)return;if(t.length===1){const a=t[0];if(Array.isArray(e)&&typeof a=="number")return e.filter((l,c)=>c!==a);const{[a]:o,...d}=e;return d}const n=t.shift();if(typeof n=="string"&&typeof e=="object")return{...e,[n]:r(e[n])};if(typeof n=="number"&&Array.isArray(e)){if(n>=e.length)return e;const a=e.slice(0,n);return[...a.length?a:new Array(n),r(e[n]),...e.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return r(s)}const $e=/^(\d+)$/gm,Be=/\.(\d+)(?=\.)/gm,ze=/^(\d+)\./gm,We=/\.(\d+$)/gm,He=/\.{2,}/gm,zt="__int__",St=`${zt}$1`;function jt(s){if(Array.isArray(s))return[...s];if(typeof s!="string")throw new Error("Path must be a string.");return s.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace($e,St).replace(Be,`.${St}.`).replace(ze,`${St}.`).replace(We,`.${St}`).replace(He,".").split(".").map(i=>{if(i.startsWith(zt)){const t=i.substring(zt.length),r=parseInt(t,10);return String(r)===t?r:t}return i})}function Ue(s){return!(Array.isArray(s)&&s.length===0)}function Wt(s,i){const t=r=>r.validators.filter(Boolean).map(e=>({cause:e.cause,validate:e.fn}));return i.validationLogic({form:i.form,validators:i.validators,event:{type:s,async:!1},runValidation:t})}function Ht(s,i){const{asyncDebounceMs:t}=i,{onBlurAsyncDebounceMs:r,onChangeAsyncDebounceMs:e,onDynamicAsyncDebounceMs:n}=i.validators||{},a=t??0,o=d=>d.validators.filter(Boolean).map(l=>{const c=(l==null?void 0:l.cause)||s;let u=a;switch(c){case"change":u=e??a;break;case"blur":u=r??a;break;case"dynamic":u=n??a;break;case"submit":u=0;break}return s==="submit"&&(u=0),{cause:c,validate:l.fn,debounceMs:u}});return i.validationLogic({form:i.form,validators:i.validators,event:{type:s,async:!0},runValidation:o})}const Ut=s=>!!s&&typeof s=="object"&&"fields"in s;function tt(s,i){if(Object.is(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;if(s instanceof Date&&i instanceof Date)return s.getTime()===i.getTime();if(s instanceof Map&&i instanceof Map){if(s.size!==i.size)return!1;for(const[e,n]of s)if(!i.has(e)||!Object.is(n,i.get(e)))return!1;return!0}if(s instanceof Set&&i instanceof Set){if(s.size!==i.size)return!1;for(const e of s)if(!i.has(e))return!1;return!0}const t=Object.keys(s),r=Object.keys(i);if(t.length!==r.length)return!1;for(const e of t)if(!r.includes(e)||!tt(s[e],i[e]))return!1;return!0}const ie=({newFormValidatorError:s,isPreviousErrorFromFormValidator:i,previousErrorValue:t})=>s?{newErrorValue:s,newSource:"form"}:i?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},se=({formLevelError:s,fieldLevelError:i})=>i?{newErrorValue:i,newSource:"field"}:s?{newErrorValue:s,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function x(s,i){return s==null?i:{...s,...i}}let X=256;const Lt=[];let Vt;for(;X--;)Lt[X]=(X+256).toString(16).substring(1);function Ne(){let s=0,i,t="";if(!Vt||X+16>256){for(Vt=new Array(256),s=256;s--;)Vt[s]=256*Math.random()|0;s=0,X=0}for(;s<16;s++)i=Vt[X+s],s===6?t+=Lt[i&15|64]:s===8?t+=Lt[i&63|128]:t+=Lt[i],s&1&&s>1&&s<11&&(t+="-");return X++,t}const et=s=>{if(!s.validators)return s.runValidation({validators:[],form:s.form});const i=s.event.async,t=i?void 0:{fn:s.validators.onMount,cause:"mount"},r={fn:i?s.validators.onChangeAsync:s.validators.onChange,cause:"change"},e={fn:i?s.validators.onBlurAsync:s.validators.onBlur,cause:"blur"},n={fn:i?s.validators.onSubmitAsync:s.validators.onSubmit,cause:"submit"},a=i?void 0:{fn:()=>{},cause:"server"};switch(s.event.type){case"mount":return s.runValidation({validators:[t],form:s.form});case"submit":return s.runValidation({validators:[r,e,n,a],form:s.form});case"server":return s.runValidation({validators:[],form:s.form});case"blur":return s.runValidation({validators:[e,a],form:s.form});case"change":return s.runValidation({validators:[r,a],form:s.form});default:throw new Error(`Unknown validation event type: ${s.event.type}`)}};function je(s,i){const t=new Map;for(const r of s){const e=r.path??[];let n=i,a="";for(let o=0;o<e.length;o++){const d=e[o];if(d===void 0)continue;const l=typeof d=="object"?d.key:d,c=Number(l);Array.isArray(n)&&!Number.isNaN(c)?a+=`[${c}]`:a+=(o>0?".":"")+String(l),typeof n=="object"&&n!==null?n=n[l]:n=void 0}t.set(a,(t.get(a)??[]).concat(r))}return Object.fromEntries(t)}const re=(s,i)=>{const t=je(s,i);return{form:t,fields:t}},st={validate({value:s,validationSource:i},t){const r=t["~standard"].validate(s);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return i==="field"?r.issues:re(r.issues,s)},async validateAsync({value:s,validationSource:i},t){const r=await t["~standard"].validate(s);if(r.issues)return i==="field"?r.issues:re(r.issues,s)}},ge=s=>!!s&&"~standard"in s,Ct={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function Ft(s){function i(u,h,f,m){const g=r(u,h,f,m);({insert:()=>o(g,u,h),remove:()=>d(g),swap:()=>m!==void 0&&c(g,u,h,m),move:()=>m!==void 0&&l(g,u,h,m)})[f]()}function t(u,h){return`${u}[${h}]`}function r(u,h,f,m){const g=[t(u,h)];if(f==="swap")g.push(t(u,m));else if(f==="move"){const[p,y]=[Math.min(h,m),Math.max(h,m)];for(let b=p;b<=y;b++)g.push(t(u,b))}else{const p=s.getFieldValue(u),y=Array.isArray(p)?p.length:0;for(let b=h+1;b<y;b++)g.push(t(u,b))}return Object.keys(s.fieldInfo).filter(p=>g.some(y=>p.startsWith(y)))}function e(u,h){return u.replace(/\[(\d+)\]/,(f,m)=>{const g=parseInt(m,10);return`[${h==="up"?g+1:Math.max(0,g-1)}]`})}function n(u,h){(h==="up"?u:[...u].reverse()).forEach(m=>{const g=e(m.toString(),h),p=s.getFieldMeta(g);p?s.setFieldMeta(m,p):s.setFieldMeta(m,a())})}const a=()=>Ct,o=(u,h,f)=>{n(u,"down"),u.forEach(m=>{m.toString().startsWith(t(h,f))&&s.setFieldMeta(m,a())})},d=u=>{n(u,"up")},l=(u,h,f,m)=>{const g=new Map(Object.keys(s.fieldInfo).filter(p=>p.startsWith(t(h,f))).map(p=>[p,s.getFieldMeta(p)]));n(u,f<m?"up":"down"),Object.keys(s.fieldInfo).filter(p=>p.startsWith(t(h,m))).forEach(p=>{const y=p.replace(t(h,m),t(h,f)),b=g.get(y);b&&s.setFieldMeta(p,b)})},c=(u,h,f,m)=>{u.forEach(g=>{if(!g.toString().startsWith(t(h,f)))return;const p=g.toString().replace(t(h,f),t(h,m)),[y,b]=[s.getFieldMeta(g),s.getFieldMeta(p)];y&&s.setFieldMeta(p,y),b&&s.setFieldMeta(g,b)})};return{handleArrayFieldMetaShift:i}}class Ge extends me{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const $=new Ge;function $t(s){return{values:s.values??{},errorMap:s.errorMap??{},fieldMetaBase:s.fieldMetaBase??{},isSubmitted:s.isSubmitted??!1,isSubmitting:s.isSubmitting??!1,isValidating:s.isValidating??!1,submissionAttempts:s.submissionAttempts??0,isSubmitSuccessful:s.isSubmitSuccessful??!1,validationMetaMap:s.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class Ke{constructor(i){var r;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var d,l;const e=this.fieldMetaDerived.mount(),n=this.store.mount(),a=()=>{e(),n(),$.emit("form-unmounted",{id:this._formId})};(l=(d=this.options.listeners)==null?void 0:d.onMount)==null||l.call(d,{formApi:this});const{onMount:o}=this.options.validators||{};return $.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),o&&this.validateSync("mount"),a},this.update=e=>{var l,c;if(!e)return;const n=this.options;this.options=e;const a=!!((c=(l=e.transform)==null?void 0:l.deps)!=null&&c.some((u,h)=>u!==this.prevTransformArray[h])),o=e.defaultValues&&!tt(e.defaultValues,n.defaultValues)&&!this.state.isTouched,d=!tt(e.defaultState,n.defaultState)&&!this.state.isTouched;!o&&!d&&!a||(z(()=>{this.baseStore.setState(()=>$t(Object.assign({},this.state,d?e.defaultState:{},o?{values:e.defaultValues}:{},a?{_force_re_eval:!this.state._force_re_eval}:{})))}),$.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(e,n)=>{const{fieldMeta:a}=this.state,o=this.resetFieldMeta(a);e&&!(n!=null&&n.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var d;return $t({...this.options.defaultState,values:e??this.options.defaultValues??((d=this.options.defaultState)==null?void 0:d.values),fieldMetaBase:o})})},this.validateAllFields=async e=>{const n=[];return z(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const d=o.instance;n.push(Promise.resolve().then(()=>d.validate(e,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(l=>({...l,isTouched:!0}))})}),(await Promise.all(n)).flat()},this.validateArrayFieldsStartingFrom=async(e,n,a)=>{const o=this.getFieldValue(e),d=Array.isArray(o)?Math.max(o.length-1,0):null,l=[`${e}[${n}]`];for(let f=n+1;f<=(d??0);f++)l.push(`${e}[${f}]`);const c=Object.keys(this.fieldInfo).filter(f=>l.some(m=>f.startsWith(m))),u=[];return z(()=>{c.forEach(f=>{u.push(Promise.resolve().then(()=>this.validateField(f,a)))})}),(await Promise.all(u)).flat()},this.validateField=(e,n)=>{var o;const a=(o=this.fieldInfo[e])==null?void 0:o.instance;return a?(a.state.meta.isTouched||a.setMeta(d=>({...d,isTouched:!0})),a.validate(n)):[]},this.validateSync=e=>{const n=Wt(e,{...this.options,form:this,validationLogic:this.options.validationLogic||et});let a=!1;const o={};return z(()=>{var c,u,h;for(const f of n){if(!f.validate)continue;const m=this.runValidator({validate:f.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:g,fieldErrors:p}=At(m),y=dt(f.cause);for(const b of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[b]===void 0)continue;const M=this.getFieldMeta(b);if(!M)continue;const{errorMap:V,errorSourceMap:F}=M,E=p==null?void 0:p[b],{newErrorValue:T,newSource:C}=ie({newFormValidatorError:E,isPreviousErrorFromFormValidator:(F==null?void 0:F[y])==="form",previousErrorValue:V==null?void 0:V[y]});C==="form"&&(o[b]={...o[b],[y]:E}),(V==null?void 0:V[y])!==T&&this.setFieldMeta(b,L=>({...L,errorMap:{...L.errorMap,[y]:T},errorSourceMap:{...L.errorSourceMap,[y]:C}}))}((c=this.state.errorMap)==null?void 0:c[y])!==g&&this.baseStore.setState(b=>({...b,errorMap:{...b.errorMap,[y]:g}})),(g||p)&&(a=!0)}const d=dt("submit");(u=this.state.errorMap)!=null&&u[d]&&e!=="submit"&&!a&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[d]:void 0}}));const l=dt("server");(h=this.state.errorMap)!=null&&h[l]&&e!=="server"&&!a&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[l]:void 0}}))}),{hasErrored:a,fieldsErrorMap:o}},this.validateAsync=async e=>{const n=Ht(e,{...this.options,form:this,validationLogic:this.options.validationLogic||et});this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const a=[];let o;for(const c of n){if(!c.validate)continue;const u=dt(c.cause),h=this.state.validationMetaMap[u];h==null||h.lastAbortController.abort();const f=new AbortController;this.state.validationMetaMap[u]={lastAbortController:f},a.push(new Promise(async m=>{let g;try{g=await new Promise((M,V)=>{setTimeout(async()=>{if(f.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:f.signal},type:"validateAsync"}))}catch(F){V(F)}},c.debounceMs)})}catch(M){g=M}const{formError:p,fieldErrors:y}=At(g);y&&(o=o?{...o,...y}:y);const b=dt(c.cause);for(const M of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[M]===void 0)continue;const V=this.getFieldMeta(M);if(!V)continue;const{errorMap:F,errorSourceMap:E}=V,T=o==null?void 0:o[M],{newErrorValue:C,newSource:L}=ie({newFormValidatorError:T,isPreviousErrorFromFormValidator:(E==null?void 0:E[b])==="form",previousErrorValue:F==null?void 0:F[b]});(F==null?void 0:F[b])!==C&&this.setFieldMeta(M,B=>({...B,errorMap:{...B.errorMap,[b]:C},errorSourceMap:{...B.errorSourceMap,[b]:L}}))}this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[b]:p}})),m(o?{fieldErrors:o,errorMapKey:b}:void 0)}))}let d=[];const l={};if(a.length){d=await Promise.all(a);for(const c of d)if(c!=null&&c.fieldErrors){const{errorMapKey:u}=c;for(const[h,f]of Object.entries(c.fieldErrors)){const g={...l[h]||{},[u]:f};l[h]=g}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),l},this.validate=e=>{const{hasErrored:n,fieldsErrorMap:a}=this.validateSync(e);return n&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>ht(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var n;return(n=this.fieldInfo)[e]||(n[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}})},this.setFieldMeta=(e,n)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:Dt(n,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((n,a)=>{const o=a;return n[o]=Ct,n},{}),this.setFieldValue=(e,n,a)=>{var c;const o=(a==null?void 0:a.dontUpdateMeta)??!1,d=(a==null?void 0:a.dontRunListeners)??!1,l=(a==null?void 0:a.dontValidate)??!1;z(()=>{o||this.setFieldMeta(e,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u==null?void 0:u.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:Mt(u.values,e,n)}))}),d||(c=this.getFieldInfo(e).instance)==null||c.triggerOnChangeListener(),l||this.validateField(e,"change")},this.deleteField=e=>{const a=[...Object.keys(this.fieldInfo).filter(o=>{const d=e.toString();return o!==d&&o.startsWith(d)}),e];this.baseStore.setState(o=>{const d={...o};return a.forEach(l=>{d.values=Re(d.values,l),delete this.fieldInfo[l],delete d.fieldMetaBase[l]}),d})},this.pushFieldValue=(e,n,a)=>{this.setFieldValue(e,o=>[...Array.isArray(o)?o:[],n],a)},this.insertFieldValue=async(e,n,a,o)=>{this.setFieldValue(e,l=>[...l.slice(0,n),a,...l.slice(n)],x(o,{dontValidate:!0}));const d=(o==null?void 0:o.dontValidate)??!1;d||await this.validateField(e,"change"),Ft(this).handleArrayFieldMetaShift(e,n,"insert"),d||await this.validateArrayFieldsStartingFrom(e,n,"change")},this.replaceFieldValue=async(e,n,a,o)=>{this.setFieldValue(e,l=>l.map((c,u)=>u===n?a:c),x(o,{dontValidate:!0})),((o==null?void 0:o.dontValidate)??!1)||(await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,n,"change"))},this.removeFieldValue=async(e,n,a)=>{const o=this.getFieldValue(e),d=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(e,c=>c.filter((u,h)=>h!==n),x(a,{dontValidate:!0})),Ft(this).handleArrayFieldMetaShift(e,n,"remove"),d!==null){const c=`${e}[${d}]`;this.deleteField(c)}((a==null?void 0:a.dontValidate)??!1)||(await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,n,"change"))},this.swapFieldValues=(e,n,a,o)=>{this.setFieldValue(e,l=>{const c=l[n],u=l[a];return Mt(Mt(l,`${n}`,u),`${a}`,c)},x(o,{dontValidate:!0})),Ft(this).handleArrayFieldMetaShift(e,n,"swap",a),((o==null?void 0:o.dontValidate)??!1)||(this.validateField(e,"change"),this.validateField(`${e}[${n}]`,"change"),this.validateField(`${e}[${a}]`,"change"))},this.moveFieldValues=(e,n,a,o)=>{this.setFieldValue(e,l=>{const c=[...l];return c.splice(a,0,c.splice(n,1)[0]),c},x(o,{dontValidate:!0})),Ft(this).handleArrayFieldMetaShift(e,n,"move",a),((o==null?void 0:o.dontValidate)??!1)||(this.validateField(e,"change"),this.validateField(`${e}[${n}]`,"change"),this.validateField(`${e}[${a}]`,"change"))},this.clearFieldValues=(e,n)=>{const a=this.getFieldValue(e),o=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(e,[],x(n,{dontValidate:!0})),o!==null)for(let l=0;l<=o;l++){const c=`${e}[${l}]`;this.deleteField(c)}((n==null?void 0:n.dontValidate)??!1)||this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[e]:Ct},values:this.options.defaultValues?Mt(n.values,e,ht(this.options.defaultValues,e)):n.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[n,a])=>(Object.keys(a).length&&a.errors.length&&(e[n]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.parseValuesWithSchema=e=>st.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>st.validateAsync({value:this.state.values,validationSource:"form"},e),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=(i==null?void 0:i.formId)??Ne(),this._devtoolsSubmissionOverride=!1,this.baseStore=new Tt($t({...i==null?void 0:i.defaultState,values:(i==null?void 0:i.defaultValues)??((r=i==null?void 0:i.defaultState)==null?void 0:r.values)})),this.fieldMetaDerived=new U({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:n,prevVal:a})=>{var h,f,m;const o=a,d=e==null?void 0:e[0],l=n[0];let c=0;const u={};for(const g of Object.keys(l.fieldMetaBase)){const p=l.fieldMetaBase[g],y=d==null?void 0:d.fieldMetaBase[g],b=o==null?void 0:o[g],M=ht(l.values,g);let V=b==null?void 0:b.errors;if(!y||p.errorMap!==y.errorMap){V=Object.values(p.errorMap??{}).filter(L=>L!==void 0);const C=(h=this.getFieldInfo(g))==null?void 0:h.instance;C&&!C.options.disableErrorFlat&&(V=V==null?void 0:V.flat(1))}const F=!Ue(V??[]),E=!p.isDirty,T=tt(M,ht(this.options.defaultValues,g))||tt(M,(m=(f=this.getFieldInfo(g))==null?void 0:f.instance)==null?void 0:m.options.defaultValue);if(b&&b.isPristine===E&&b.isValid===F&&b.isDefaultValue===T&&b.errors===V&&p===y){u[g]=b,c++;continue}u[g]={...p,errors:V,isPristine:E,isValid:F,isDefaultValue:T}}return Object.keys(l.fieldMetaBase).length&&o&&c===Object.keys(l.fieldMetaBase).length?o:u}}),this.store=new U({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:n,prevVal:a})=>{var pt,ut,N,bt;const o=a,d=e==null?void 0:e[0],l=n[0],c=n[1],u=Object.values(c).filter(Boolean),h=u.some(S=>S.isValidating),f=u.every(S=>S.isValid),m=u.some(S=>S.isTouched),g=u.some(S=>S.isBlurred),p=u.every(S=>S.isDefaultValue),y=m&&((pt=l.errorMap)==null?void 0:pt.onMount),b=u.some(S=>S.isDirty),M=!b,V=!!((ut=l.errorMap)!=null&&ut.onMount||u.some(S=>{var R;return(R=S==null?void 0:S.errorMap)==null?void 0:R.onMount})),F=!!h;let E=(o==null?void 0:o.errors)??[];(!d||l.errorMap!==d.errorMap)&&(E=Object.values(l.errorMap).reduce((S,R)=>R===void 0?S:R&&Ut(R)?(S.push(R.form),S):(S.push(R),S),[]));const T=E.length===0,C=f&&T,L=this.options.canSubmitWhenInvalid??!1,B=l.submissionAttempts===0&&!m&&!V||!F&&!l.isSubmitting&&C||L;let W=l.errorMap;if(y&&(E=E.filter(S=>S!==l.errorMap.onMount),W=Object.assign(W,{onMount:void 0})),o&&d&&o.errorMap===W&&o.fieldMeta===this.fieldMetaDerived.state&&o.errors===E&&o.isFieldsValidating===h&&o.isFieldsValid===f&&o.isFormValid===T&&o.isValid===C&&o.canSubmit===B&&o.isTouched===m&&o.isBlurred===g&&o.isPristine===M&&o.isDefaultValue===p&&o.isDirty===b&&tt(d,l))return o;let ot={...l,errorMap:W,fieldMeta:this.fieldMetaDerived.state,errors:E,isFieldsValidating:h,isFieldsValid:f,isFormValid:T,isValid:C,canSubmit:B,isTouched:m,isBlurred:g,isPristine:M,isDefaultValue:p,isDirty:b};const lt=((N=this.options.transform)==null?void 0:N.deps)??[];if(lt.length!==this.prevTransformArray.length||lt.some((S,R)=>S!==this.prevTransformArray[R])){const S=Object.assign({},this,{state:ot});(bt=this.options.transform)==null||bt.fn(S),ot=S.state,this.prevTransformArray=lt}return ot}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(i||{});const t=Pe(e=>$.emit("form-state",{id:this._formId,state:e}),{wait:300});this.store.subscribe(()=>{t(this.store.state)}),$.on("request-form-state",e=>{e.payload.id===this._formId&&$.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),$.on("request-form-reset",e=>{e.payload.id===this._formId&&this.reset()}),$.on("request-form-force-submit",e=>{e.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(i){return ge(i.validate)?st[i.type](i.value,i.validate):i.validate(i.value)}async handleSubmit(i){var e,n,a,o,d,l,c,u,h,f;this.baseStore.setState(m=>({...m,isSubmitted:!1,submissionAttempts:m.submissionAttempts+1,isSubmitSuccessful:!1})),z(()=>{Object.values(this.fieldInfo).forEach(m=>{m.instance&&(m.instance.state.meta.isTouched||m.instance.setMeta(g=>({...g,isTouched:!0})))})});const t=i??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){(n=(e=this.options).onSubmitInvalid)==null||n.call(e,{value:this.state.values,formApi:this,meta:t});return}this.baseStore.setState(m=>({...m,isSubmitting:!0}));const r=()=>{this.baseStore.setState(m=>({...m,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){r(),(o=(a=this.options).onSubmitInvalid)==null||o.call(a,{value:this.state.values,formApi:this,meta:t}),$.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(m=>m.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){r(),(l=(d=this.options).onSubmitInvalid)==null||l.call(d,{value:this.state.values,formApi:this,meta:t}),$.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}z(()=>{Object.values(this.fieldInfo).forEach(m=>{var g,p,y;(y=(p=(g=m.instance)==null?void 0:g.options.listeners)==null?void 0:p.onSubmit)==null||y.call(p,{value:m.instance.state.value,fieldApi:m.instance})})}),(u=(c=this.options.listeners)==null?void 0:c.onSubmit)==null||u.call(c,{formApi:this,meta:t});try{await((f=(h=this.options).onSubmit)==null?void 0:f.call(h,{value:this.state.values,formApi:this,meta:t})),z(()=>{this.baseStore.setState(m=>({...m,isSubmitted:!0,isSubmitSuccessful:!0})),$.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),r()})}catch(m){throw this.baseStore.setState(g=>({...g,isSubmitSuccessful:!1})),$.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:m}),r(),m}}setErrorMap(i){z(()=>{Object.entries(i).forEach(([t,r])=>{const e=t;if(Ut(r)){const{formError:n,fieldErrors:a}=At(r);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,l=>({...l,errorMap:{...l.errorMap,[e]:a==null?void 0:a[o]},errorSourceMap:{...l.errorSourceMap,[e]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[e]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[e]:r}}))})})}}function At(s){if(s){if(Ut(s)){const i=At(s.form).formError,t=s.fields;return{formError:i,fieldErrors:t}}return{formError:s}}return{formError:void 0}}function dt(s){switch(s){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class qe{constructor(i){this.options={},this.mount=()=>{var n,a;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const r=this.getInfo();r.instance=this,this.update(this.options);const{onMount:e}=this.options.validators||{};if(e){const o=this.runValidator({validate:e,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(d=>({...d,errorMap:{...d==null?void 0:d.errorMap,onMount:o},errorSourceMap:{...d==null?void 0:d.errorSourceMap,onMount:"field"}}))}return(a=(n=this.options.listeners)==null?void 0:n.onMount)==null||a.call(n,{value:this.state.value,fieldApi:this}),t},this.update=t=>{this.options=t;const r=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const e=ht(t.form.options.defaultValues,t.name),n=t.defaultValue??e;r?this.setValue(a=>a||n,{dontUpdateMeta:!0}):n!==void 0&&this.setValue(n,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,r)=>{this.form.setFieldValue(this.name,t,x(r,{dontRunListeners:!0,dontValidate:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener(),r!=null&&r.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,r)=>{this.form.pushFieldValue(this.name,t,x(r,{dontRunListeners:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(t,r,e)=>{this.form.insertFieldValue(this.name,t,r,x(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(t,r,e)=>{this.form.replaceFieldValue(this.name,t,r,x(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(t,r)=>{this.form.removeFieldValue(this.name,t,x(r,{dontRunListeners:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(t,r,e)=>{this.form.swapFieldValues(this.name,t,r,x(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(t,r,e)=>{this.form.moveFieldValues(this.name,t,r,x(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,x(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=t=>{const r=Object.values(this.form.fieldInfo),e=[];for(const n of r){if(!n.instance)continue;const{onChangeListenTo:a,onBlurListenTo:o}=n.instance.options.validators||{};t==="change"&&(a!=null&&a.includes(this.name))&&e.push(n.instance),t==="blur"&&(o!=null&&o.includes(this.name))&&e.push(n.instance)}return e},this.validateSync=(t,r)=>{var l;const e=Wt(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||et}),a=this.getLinkedFields(t).reduce((c,u)=>{const h=Wt(t,{...u.options,form:u.form,validationLogic:u.form.options.validationLogic||et});return h.forEach(f=>{f.field=u}),c.concat(h)},[]);let o=!1;z(()=>{const c=(u,h)=>{var b;const f=Et(h.cause),m=h.validate?ne(u.runValidator({validate:h.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,g=r[f],{newErrorValue:p,newSource:y}=se({formLevelError:g,fieldLevelError:m});((b=u.state.meta.errorMap)==null?void 0:b[f])!==p&&u.setMeta(M=>({...M,errorMap:{...M.errorMap,[f]:p},errorSourceMap:{...M.errorSourceMap,[f]:y}})),p&&(o=!0)};for(const u of e)c(this,u);for(const u of a)u.validate&&c(u.field,u)});const d=Et("submit");return(l=this.state.meta.errorMap)!=null&&l[d]&&t!=="submit"&&!o&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[d]:void 0},errorSourceMap:{...c.errorSourceMap,[d]:void 0}})),{hasErrored:o}},this.validateAsync=async(t,r)=>{const e=Ht(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||et}),n=await r,a=this.getLinkedFields(t),o=a.reduce((h,f)=>{const m=Ht(t,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||et});return m.forEach(g=>{g.field=f}),h.concat(m)},[]);this.state.meta.isValidating||this.setMeta(h=>({...h,isValidating:!0}));for(const h of a)h.setMeta(f=>({...f,isValidating:!0}));const d=[],l=[],c=(h,f,m)=>{const g=Et(f.cause),p=h.getInfo().validationMetaMap[g];p==null||p.lastAbortController.abort();const y=new AbortController;this.getInfo().validationMetaMap[g]={lastAbortController:y},m.push(new Promise(async b=>{var C;let M;try{M=await new Promise((L,B)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(y.signal.aborted)return L(void 0);try{L(await this.runValidator({validate:f.validate,value:{value:h.store.state.value,fieldApi:h,signal:y.signal,validationSource:"field"},type:"validateAsync"}))}catch(W){B(W)}},f.debounceMs)})}catch(L){M=L}if(y.signal.aborted)return b(void 0);const V=ne(M),F=(C=n[this.name])==null?void 0:C[g],{newErrorValue:E,newSource:T}=se({formLevelError:F,fieldLevelError:V});h.setMeta(L=>({...L,errorMap:{...L==null?void 0:L.errorMap,[g]:E},errorSourceMap:{...L.errorSourceMap,[g]:T}})),b(E)}))};for(const h of e)h.validate&&c(this,h,d);for(const h of o)h.validate&&c(h.field,h,l);let u=[];(d.length||l.length)&&(u=await Promise.all(d),await Promise.all(l)),this.setMeta(h=>({...h,isValidating:!1}));for(const h of a)h.setMeta(f=>({...f,isValidating:!1}));return u.filter(Boolean)},this.validate=(t,r)=>{var o;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:e}=r!=null&&r.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:n}=this.validateSync(t,e[this.name]??{});if(n&&!this.options.asyncAlways)return(o=this.getInfo().validationMetaMap[Et(t)])==null||o.lastAbortController.abort(),this.state.meta.errors;const a=r!=null&&r.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,a)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(r=>({...r,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(r=>({...r,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>st.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>st.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=i.form,this.name=i.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new U({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),r=this.form.getFieldMeta(this.name)??{...Ct,...i.defaultMeta};return{value:t,meta:r}}}),this.options=i}get state(){return this.store.state}runValidator(i){return ge(i.validate)?st[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...i}}))}triggerOnBlurListener(){var r,e,n,a,o,d;const i=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;i&&i>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var l,c;(c=(l=this.form.options.listeners)==null?void 0:l.onBlur)==null||c.call(l,{formApi:this.form,fieldApi:this})},i)):(n=(e=this.form.options.listeners)==null?void 0:e.onBlur)==null||n.call(e,{formApi:this.form,fieldApi:this});const t=(a=this.options.listeners)==null?void 0:a.onBlurDebounceMs;t&&t>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var l,c;(c=(l=this.options.listeners)==null?void 0:l.onBlur)==null||c.call(l,{value:this.state.value,fieldApi:this})},t)):(d=(o=this.options.listeners)==null?void 0:o.onBlur)==null||d.call(o,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,e,n,a,o,d;const i=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;i&&i>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var l,c;(c=(l=this.form.options.listeners)==null?void 0:l.onChange)==null||c.call(l,{formApi:this.form,fieldApi:this})},i)):(n=(e=this.form.options.listeners)==null?void 0:e.onChange)==null||n.call(e,{formApi:this.form,fieldApi:this});const t=(a=this.options.listeners)==null?void 0:a.onChangeDebounceMs;t&&t>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var l,c;(c=(l=this.options.listeners)==null?void 0:l.onChange)==null||c.call(l,{value:this.state.value,fieldApi:this})},t)):(d=(o=this.options.listeners)==null?void 0:o.onChange)==null||d.call(o,{value:this.state.value,fieldApi:this})}}function ne(s){if(s)return s}function Et(s){switch(s){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}function pe(s,i=t=>t){return Fe.useSyncExternalStoreWithSelector(s.subscribe,()=>s.state,()=>s.state,i,Xe)}function Xe(s,i){if(Object.is(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;if(s instanceof Map&&i instanceof Map){if(s.size!==i.size)return!1;for(const[r,e]of s)if(!i.has(r)||!Object.is(e,i.get(r)))return!1;return!0}if(s instanceof Set&&i instanceof Set){if(s.size!==i.size)return!1;for(const r of s)if(!i.has(r))return!1;return!0}if(s instanceof Date&&i instanceof Date)return s.getTime()===i.getTime();const t=ae(s);if(t.length!==ae(i).length)return!1;for(let r=0;r<t.length;r++)if(!Object.prototype.hasOwnProperty.call(i,t[r])||!Object.is(s[t[r]],i[t[r]]))return!1;return!0}function ae(s){return Object.keys(s).concat(Object.getOwnPropertySymbols(s))}const kt=typeof window<"u"?I.useLayoutEffect:I.useEffect;function Ye(s){const[i]=I.useState(()=>{const r=new qe({...s,form:s.form,name:s.name});return r.Field=be,r});return kt(i.mount,[i]),kt(()=>{i.update(s)}),pe(i.store,s.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),i}const be=({children:s,...i})=>{const t=Ye(i),r=I.useMemo(()=>Dt(s,t),[s,t,t.state.value,t.state.meta]);return k.jsx(k.Fragment,{children:r})};function Ze({form:s,selector:i,children:t}){const r=pe(s.store,i);return Dt(t,r)}function yi(s){const i=I.useId(),[t]=I.useState(()=>{const r=new Ke({...s,formId:i}),e=r;return e.Field=function(a){return k.jsx(be,{...a,form:r})},e.Subscribe=function(a){return k.jsx(Ze,{form:r,selector:a.selector,children:a.children})},e});return kt(t.mount,[]),kt(()=>{t.update(s)}),t}function Nt(){return Nt=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},Nt.apply(null,arguments)}function Je(s,i){if(s==null)return{};var t={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(i.indexOf(r)!==-1)continue;t[r]=s[r]}return t}var Qe=I.useLayoutEffect,ti=function(i){var t=Bt.useRef(i);return Qe(function(){t.current=i}),t},oe=function(i,t){if(typeof i=="function"){i(t);return}i.current=t},ei=function(i,t){var r=Bt.useRef();return Bt.useCallback(function(e){i.current=e,r.current&&oe(r.current,null),r.current=t,t&&oe(t,e)},[t])},le={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},ii=function(i){Object.keys(le).forEach(function(t){i.style.setProperty(t,le[t],"important")})},ue=ii,_=null,de=function(i,t){var r=i.scrollHeight;return t.sizingStyle.boxSizing==="border-box"?r+t.borderSize:r-t.paddingSize};function si(s,i,t,r){t===void 0&&(t=1),r===void 0&&(r=1/0),_||(_=document.createElement("textarea"),_.setAttribute("tabindex","-1"),_.setAttribute("aria-hidden","true"),ue(_)),_.parentNode===null&&document.body.appendChild(_);var e=s.paddingSize,n=s.borderSize,a=s.sizingStyle,o=a.boxSizing;Object.keys(a).forEach(function(h){var f=h;_.style[f]=a[f]}),ue(_),_.value=i;var d=de(_,s);_.value=i,d=de(_,s),_.value="x";var l=_.scrollHeight-e,c=l*t;o==="border-box"&&(c=c+e+n),d=Math.max(c,d);var u=l*r;return o==="border-box"&&(u=u+e+n),d=Math.min(u,d),[d,l]}var ce=function(){},ri=function(i,t){return i.reduce(function(r,e){return r[e]=t[e],r},{})},ni=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],ai=!!document.documentElement.currentStyle,oi=function(i){var t=window.getComputedStyle(i);if(t===null)return null;var r=ri(ni,t),e=r.boxSizing;if(e==="")return null;ai&&e==="border-box"&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var n=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),a=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:n,borderSize:a}},li=oi;function Gt(s,i,t){var r=ti(t);I.useLayoutEffect(function(){var e=function(a){return r.current(a)};if(s)return s.addEventListener(i,e),function(){return s.removeEventListener(i,e)}},[])}var ui=function(i,t){Gt(document.body,"reset",function(r){i.current.form===r.target&&t(r)})},di=function(i){Gt(window,"resize",i)},ci=function(i){Gt(document.fonts,"loadingdone",i)},hi=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],fi=function(i,t){var r=i.cacheMeasurements,e=i.maxRows,n=i.minRows,a=i.onChange,o=a===void 0?ce:a,d=i.onHeightChange,l=d===void 0?ce:d,c=Je(i,hi),u=c.value!==void 0,h=I.useRef(null),f=ei(h,t),m=I.useRef(0),g=I.useRef(),p=function(){var M=h.current,V=r&&g.current?g.current:li(M);if(V){g.current=V;var F=si(V,M.value||M.placeholder||"x",n,e),E=F[0],T=F[1];m.current!==E&&(m.current=E,M.style.setProperty("height",E+"px","important"),l(E,{rowHeight:T}))}},y=function(M){u||p(),o(M)};return I.useLayoutEffect(p),ui(h,function(){if(!u){var b=h.current.value;requestAnimationFrame(function(){var M=h.current;M&&b!==M.value&&p()})}}),di(p),ci(p),I.createElement("textarea",Nt({},c,{onChange:y,ref:f}))},mi=I.forwardRef(fi),ye=Ee(({style:s,minRows:i=3,maxRows:t=8,cacheMeasurements:r=!1,disableAutosize:e=!1,onHeightChange:n,...a},o)=>{const{Component:d,label:l,description:c,startContent:u,endContent:h,hasHelper:f,shouldLabelBeOutside:m,shouldLabelBeInside:g,isInvalid:p,errorMessage:y,getBaseProps:b,getLabelProps:M,getInputProps:V,getInnerWrapperProps:F,getInputWrapperProps:E,getHelperWrapperProps:T,getDescriptionProps:C,getErrorMessageProps:L,isClearable:B,getClearButtonProps:W}=we({...a,ref:o,isMultiline:!0}),[ot,lt]=I.useState(i>1),[Kt,pt]=I.useState(!1),ut=l?k.jsx("label",{...M(),children:l}):null,N=V(),bt=(xt,Pt)=>{if(i===1&&lt(xt>=Pt.rowHeight*2),t>i){const Ve=xt>=t*Pt.rowHeight;pt(Ve)}n==null||n(xt,Pt)},S=e?k.jsx("textarea",{...N,style:Jt(N.style,s??{})}):k.jsx(mi,{...N,cacheMeasurements:r,"data-hide-scroll":Qt(!Kt),maxRows:t,minRows:i,style:Jt(N.style,s??{}),onHeightChange:bt}),R=I.useMemo(()=>B?k.jsx("button",{...W(),children:k.jsx(Le,{})}):null,[B,W]),Me=I.useMemo(()=>u||h?k.jsxs("div",{...F(),children:[u,S,h]}):k.jsx("div",{...F(),children:S}),[u,N,h,F]),qt=p&&y,Se=qt||c;return k.jsxs(d,{...b(),children:[m?ut:null,k.jsxs("div",{...E(),"data-has-multiple-rows":Qt(ot),children:[g?ut:null,Me,R]}),f&&Se?k.jsx("div",{...T(),children:qt?k.jsx("div",{...L(),children:y}):k.jsx("div",{...C(),children:c})}):null]})});ye.displayName="HeroUI.Textarea";var Mi=ye;export{Mi as t,yi as u};
